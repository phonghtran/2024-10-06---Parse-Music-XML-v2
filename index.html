<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>My Express App</title>

    <style>
        body {
            background-color: black;
            color: white;
        }
    </style>
</head>

<body>
    <h1>Script Output:</h1>

    <p><button id="bttnFetch">Fetch</button></p>


    <p>
        <button id="bttnRunParse">Run Parse</button>

    </p>

    <p>
        <button id="bttnDropTable">Drop Table</button>
    </p>
    <div id="tracks"></div>
    <pre id="output"></pre>
    <script>

        // Selecting an element by its ID
        const bttnRunParse = document.getElementById('bttnRunParse');
        const bttnDropTable = document.getElementById('bttnDropTable');

        const bttnFetch = document.getElementById('bttnFetch');




        function fetchRows() {
            console.log('fetching')
            fetch('/tracks')
                .then(response => {
                    console.log(response)

                    if (response.ok) { // Check if response is OK (200-299)
                        return response.json(); // If true, return the JSON data
                    } else {
                        throw new Error(`Error ${response.status}: ${response.statusText}`); // Otherwise, rethrow an error
                    }

                })
                .then(data => {
                    const tracksDiv = document.getElementById('tracks');

                    tracksDiv.innerHTML = ''


                    data.forEach(track => {
                        console.log(track)
                        const trackDiv = document.createElement('div');
                        trackDiv.textContent = `ID: ${track.id}, 
                    playlistName: ${track.playlistName},trackPosition: ${track.trackPosition}, artist: ${track.artist}, Name: ${track.name}, genre: ${track.genre}`;
                        tracksDiv.appendChild(trackDiv);
                    });
                })
                .catch(error => console.error('Error fetching tracks:', error))
                .finally(() => {
                    const bttnRunParse = document.getElementById('bttnRunParse');
                    bttnFetch.disabled = false
                });
        }

        function dropTable() {
            console.log('dropping')
            fetch('/drop')
                .then(response => console.log(response))
                .catch(error => console.error('Error dropping table', error))
                ;
        }



        function runParse() {
            console.log('running parse')
            fetch('/run-script')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('output').innerText = data;
                });
        }


        // Adding an event listener to the selected element
        bttnRunParse.addEventListener('click', function () {
            // bttnRunParse.disabled = true;
            runParse(); fetchRows();
        });

        // Adding an event listener to the selected element
        bttnFetch.addEventListener('click', function () {
            // bttnFetch.disabled = true;
            fetchRows();

        });

        bttnDropTable.addEventListener('click', function () {

            dropTable();

        });
    </script>
</body>

</html>