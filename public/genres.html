<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>My Express App</title>

    <style>
        .rowGenre {
            display: flex;
            flex-direction: row;
        }

        .playlistName {}

        .vizGenre {
            background-color: #eee;
            display: flex;
            flex-direction: row;
            flex-grow: 1;
        }

        .barViz {
            flex-grow: 1;
            font-size: 0.75rem;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="container"></div>

    the primary genres get a hex color and the further from letter match - change the saturation to a floor
    everything else is undefined as a hex

    wuzzy.jarowinkler(testArray[i], strArray[j])
    import wuzzy from 'wuzzy';

    npm i colord
    console.log(colord("#ff0000").grayscale().alpha(0.25).toRgbString())

    Pop - 1425
    undefined - 868
    Hip-Hop/Rap - 828
    Alternative - 822
    K-Pop - 505
    R&B/Soul - 494
    Electronic - 393
    Dance - 283
    Indie - 273
    Rock - 257
    Alt Rock - 223
    Rap - 221
    R&B - 119
    Hip-Hop - 115
    Country - 106
    Hip Hop/Rap - 94
    Indie Rock - 68
    Singer/Songwriter - 68
    Urbano latino - 57

    <script>




        const getColor = async () => {
            const res = await fetch('/colord');
            if (res.ok) {
                const data = await res.json();
                console.log(data, "inside ");
            }
        }

        const resp = getColor().then(() => {
            console.log(resp, "inside the then waiting")
        }).catch((error) => console.error(error));

        console.log(resp, "outside")




        fetchTable()


        const hexColors = [
            "#FF0000", // Red
            "#00FF00", // Green
            "#0000FF", // Blue
            "#FFFF00", // Yellow
            "#FF00FF", // Magenta
            "#800000", // Brown
            "#008000", // Forest Green
            "#000080", // Navy Blue
            "#808000", // Olive Drab
            "#C0C0C0", // Light Gray
            "#800080", // Purple
            "#FFFFCC", // Light Yellow
            "#FF9900", // Orange
            "#66CCCC", // Sky Blue
            "#00BFFF", // Baby Blue
            "#999966", // Tan
            "#33CC33", // Lime Green
            "#CC99CC", // Pastel Pink
            "#663333", // Dark Brown
            "#FFCC33" // Golden Yellow
        ];



        function fetchTable() {

            fetch(`/genresgraph`)
                .then(response => {
                    if (response.ok) { // Check if response is OK (200-299)
                        return response.json(); // If true, return the JSON data
                    } else {
                        throw new Error(`Error ${response.status}: ${response.statusText}`); // Otherwise, rethrow an error
                    }

                })
                .then(data => {

                    let grouped = data.reduce((acc, track) => {
                        const playlistName = track.playlistName;
                        if (!acc[playlistName]) acc[playlistName] = [];
                        acc[playlistName].push(track);
                        return acc;
                    }, {});

                    const container = document.getElementById('container')



                    for (pl in grouped) {
                        const plist = grouped[pl]

                        const rowGenre = document.createElement('div')
                        rowGenre.classList.add('rowGenre')

                        const playlistName = document.createElement('div')
                        playlistName.textContent = pl
                        playlistName.classList.add('playlistName')
                        rowGenre.appendChild(playlistName)



                        const vizGenre = document.createElement('div')
                        vizGenre.classList.add('vizGenre')



                        let genreCount = 0;
                        for (var i = 0; i < plist.length; i++) {
                            const track = plist[i]
                            genreCount += track.count
                        }//count total

                        let color = 0
                        for (var i = 0; i < plist.length; i++) {
                            const track = plist[i]

                            // console.log(track)

                            const barViz = document.createElement('div')
                            barViz.classList.add('barViz')
                            barViz.classList.add(`barVizColor${color}`)
                            barViz.dataset.genre = track.genre
                            barViz.dataset.count = track.count
                            barViz.style.width = `${track.count / genreCount}%`
                            barViz.style.backgroundColor = hexColors[color]
                            barViz.textContent = track.genre


                            vizGenre.appendChild(barViz)

                            color++

                        } // each track



                        rowGenre.appendChild(vizGenre)
                        container.appendChild(rowGenre)
                    }// for




                })
                .catch(error => console.error('Error fetching tracks:', error))
                ;
        }// fetch table
    </script>
</body>

</html>